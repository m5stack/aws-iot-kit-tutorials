<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core2 for AWS IoT EduKit BSP: Core2ForAWS_Port_A_I2C_Begin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="AWS_logo_RGB.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Core2 for AWS IoT EduKit BSP
   &#160;<span id="projectnumber">1.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="expports.html">External Grove Connector Expansion Ports</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Core2ForAWS_Port_A_I2C_Begin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Allocates a peripheral connected to expansion port A.</p>
<div class="fragment"><div class="line"><a class="code" href="i2c__device_8h.html#a544e7981e2ae57ea1a0dfd91ba69845c">I2CDevice_t</a> <a class="code" href="core2for_a_w_s_8c.html#a3b48f559933447fce3325cf959c07e4f">Core2ForAWS_Port_A_I2C_Begin</a>(uint8_t device_address, uint32_t baud);</div>
<div class="ttc" id="acore2for_a_w_s_8c_html_a3b48f559933447fce3325cf959c07e4f"><div class="ttname"><a href="core2for_a_w_s_8c.html#a3b48f559933447fce3325cf959c07e4f">Core2ForAWS_Port_A_I2C_Begin</a></div><div class="ttdeci">I2CDevice_t Core2ForAWS_Port_A_I2C_Begin(uint8_t device_address, uint32_t baud)</div><div class="ttdoc">Allocates a peripheral connected to expansion port A.</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:514</div></div>
<div class="ttc" id="ai2c__device_8h_html_a544e7981e2ae57ea1a0dfd91ba69845c"><div class="ttname"><a href="i2c__device_8h.html#a544e7981e2ae57ea1a0dfd91ba69845c">I2CDevice_t</a></div><div class="ttdeci">void * I2CDevice_t</div><div class="ttdoc">A pointer to the I2C peripheral configuration.</div><div class="ttdef"><b>Definition:</b> i2c_device.h:41</div></div>
</div><!-- fragment --><p> This function allocates configuration of an attached I2C peripheral on expansion port A with a minimum baud rate of 100,000Hz. The macro <a class="el" href="core2for_a_w_s_8h.html#a8572d2fbbeceb5f6005caa772127bc32">PORT_A_I2C_STANDARD_BAUD</a> can used for a generally compatible baud rate for most peripherals. The maximum rate supported by the ESP32-D0WD is 5MHz.</p>
<p>Read more about <a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/peripherals/i2c.html">I2C capabilities of the ESP32 microcontroller and available APIs in the ESP-IDF</a>.</p>
<dl class="section note"><dt>Note</dt><dd>The AXP192 PMU is configured to output 5v on the expansion port's VCC pin. Some peripherals require 3.3V and requires adjusting the output from the AXP192. This is currently unsupported, but can be acheived using the AXP192 driver (located in the <b>core2forAWS/axp192</b> folder) for advanced developers.</dd></dl>
<p>The example code allocates a I2C heart rate sensor peripheral in the variable port_A_peripheral of type I2CDevice_t that has an 8-bit device address of 0xA0 (right-shifted by 1-bit to be a 7-bit address) and using the standard baud rate. It then waits 10 seconds before looping to read from the peripheral, and since the device doesn't take a register address, it uses the macro <a class="el" href="i2c__device_8h.html#ad3ffe5dc6c86353866b9e81d2d7afbd2">I2C_NO_REG</a>. The reading is printed every 10 seconds to the serial output.</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;freertos/FreeRTOS.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;freertos/task.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;esp_log.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="core2for_a_w_s_8h.html">core2forAWS.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DEVICE_ADDRESS 0xA0 &gt;&gt; 1</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="i2c__device_8c.html#afc3d101f633a076cc1ca84b85b6224b2">TAG</a> = <span class="stringliteral">&quot;MAIN&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> i2c_test_task(<span class="keywordtype">void</span> * param){</div>
<div class="line">    <a class="code" href="i2c__device_8h.html#a544e7981e2ae57ea1a0dfd91ba69845c">I2CDevice_t</a> port_A_peripheral = <a class="code" href="core2for_a_w_s_8c.html#a3b48f559933447fce3325cf959c07e4f">Core2ForAWS_Port_A_I2C_Begin</a>(DEVICE_ADDRESS, <a class="code" href="core2for_a_w_s_8h.html#a8572d2fbbeceb5f6005caa772127bc32">PORT_A_I2C_STANDARD_BAUD</a>);</div>
<div class="line">    </div>
<div class="line">    vTaskDelay(pdMS_TO_TICKS(10000));</div>
<div class="line">    <span class="keywordflow">for</span>(;;){</div>
<div class="line">        uint8_t heart_rate = 255;</div>
<div class="line">        esp_err_t err = <a class="code" href="core2for_a_w_s_8c.html#a8ca28405ee964ae83568a6b483d5a11d">Core2ForAWS_Port_A_I2C_Read</a>(port_A_peripheral, <a class="code" href="i2c__device_8h.html#ad3ffe5dc6c86353866b9e81d2d7afbd2">I2C_NO_REG</a>, &amp;heart_rate, 1);</div>
<div class="line">        <span class="keywordflow">if</span>(!err){</div>
<div class="line">            ESP_LOGI(<a class="code" href="i2c__device_8c.html#afc3d101f633a076cc1ca84b85b6224b2">TAG</a>, <span class="stringliteral">&quot;Heart Rate â€” %ubpm&quot;</span>, heart_rate);    </div>
<div class="line">        }</div>
<div class="line">        vTaskDelay(pdMS_TO_TICKS(10000));</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="core2for_a_w_s_8c.html#a057922ede225141694594f4adda7df7b">Core2ForAWS_Port_A_I2C_Close</a>(port_A_peripheral);</div>
<div class="line">    vTaskDelete(NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> app_main()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="core2for_a_w_s_8c.html#a3d850a3f56bbe0685b60726d8b53bece">Core2ForAWS_Init</a>();</div>
<div class="line">    xTaskCreatePinnedToCore(&amp;i2c_test_task, <span class="stringliteral">&quot;i2c_test_task&quot;</span>, 4096, NULL, 5, NULL, 1);</div>
<div class="line">}</div>
<div class="ttc" id="acore2for_a_w_s_8c_html_a057922ede225141694594f4adda7df7b"><div class="ttname"><a href="core2for_a_w_s_8c.html#a057922ede225141694594f4adda7df7b">Core2ForAWS_Port_A_I2C_Close</a></div><div class="ttdeci">void Core2ForAWS_Port_A_I2C_Close(I2CDevice_t device)</div><div class="ttdoc">Frees the configuration pointer to the I2C peripheral connected on port A.</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:526</div></div>
<div class="ttc" id="acore2for_a_w_s_8c_html_a3d850a3f56bbe0685b60726d8b53bece"><div class="ttname"><a href="core2for_a_w_s_8c.html#a3d850a3f56bbe0685b60726d8b53bece">Core2ForAWS_Init</a></div><div class="ttdeci">void Core2ForAWS_Init(void)</div><div class="ttdoc">Initializes the power chip with default values, enables battery charging, and initializes all enabled...</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:32</div></div>
<div class="ttc" id="acore2for_a_w_s_8c_html_a8ca28405ee964ae83568a6b483d5a11d"><div class="ttname"><a href="core2for_a_w_s_8c.html#a8ca28405ee964ae83568a6b483d5a11d">Core2ForAWS_Port_A_I2C_Read</a></div><div class="ttdeci">esp_err_t Core2ForAWS_Port_A_I2C_Read(I2CDevice_t device, uint32_t register_address, uint8_t *data, uint16_t length)</div><div class="ttdoc">Reads from I2C peripheral connected to expansion port A.</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:518</div></div>
<div class="ttc" id="acore2for_a_w_s_8h_html"><div class="ttname"><a href="core2for_a_w_s_8h.html">core2forAWS.h</a></div><div class="ttdoc">Functions to initialize and access Core2 for AWS IoT EduKit hardware features.</div></div>
<div class="ttc" id="acore2for_a_w_s_8h_html_a8572d2fbbeceb5f6005caa772127bc32"><div class="ttname"><a href="core2for_a_w_s_8h.html#a8572d2fbbeceb5f6005caa772127bc32">PORT_A_I2C_STANDARD_BAUD</a></div><div class="ttdeci">#define PORT_A_I2C_STANDARD_BAUD</div><div class="ttdoc">The standard baud rate for I2C peripherals connected to Port A.</div><div class="ttdef"><b>Definition:</b> core2forAWS.h:191</div></div>
<div class="ttc" id="ai2c__device_8c_html_afc3d101f633a076cc1ca84b85b6224b2"><div class="ttname"><a href="i2c__device_8c.html#afc3d101f633a076cc1ca84b85b6224b2">TAG</a></div><div class="ttdeci">#define TAG</div><div class="ttdef"><b>Definition:</b> i2c_device.c:10</div></div>
<div class="ttc" id="ai2c__device_8h_html_ad3ffe5dc6c86353866b9e81d2d7afbd2"><div class="ttname"><a href="i2c__device_8h.html#ad3ffe5dc6c86353866b9e81d2d7afbd2">I2C_NO_REG</a></div><div class="ttdeci">#define I2C_NO_REG</div><div class="ttdoc">Used when the I2C peripheral does not use registers for read/write operations.</div><div class="ttdef"><b>Definition:</b> i2c_device.h:24</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device_address</td><td>The 7-bit I2C device address. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">baud</td><td>The baud rate of I2C communications. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the I2C device configuration. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
