<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core2 for AWS IoT EduKit BSP: Core2ForAWS_SDcard_Mount</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="AWS_logo_RGB.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Core2 for AWS IoT EduKit BSP
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="sdcard.html">SD-Card</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Core2ForAWS_SDcard_Mount </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Initializes and mounts the SD-Card.</p>
<div class="fragment"><div class="line">esp_err_t <a class="code" href="core2for_a_w_s_8h.html#a714fd9c7943bbec98c54dfa17d778853">Core2ForAWS_SDcard_Mount</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *mount_path, sdmmc_card_t **out_card);</div>
<div class="ttc" id="acore2for_a_w_s_8h_html_a714fd9c7943bbec98c54dfa17d778853"><div class="ttname"><a href="core2for_a_w_s_8h.html#a714fd9c7943bbec98c54dfa17d778853">Core2ForAWS_SDcard_Mount</a></div><div class="ttdeci">esp_err_t Core2ForAWS_SDcard_Mount(const char *mount_path, sdmmc_card_t **out_card)</div><div class="ttdoc">Initializes and mounts the SD-Card.</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:102</div></div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The SD Card must be mounted before use. The SD card and the screen uses the same SPI bus. In order to avoid conflicts with the screen, you must take the spi_mutex semaphore, then call <a class="el" href="disp__spi_8h.html#a3dc6a7525e5a0b34e37a3a64478ec9ee" title="Polls the SPI bus for a pending SPI transaction to complete.">spi_poll()</a> before accessing the SD card. Once done, give/free the semaphore so the display can take it. The display task will then continue to update the display controller on the SPI bus.</dd></dl>
<p>Reading/writing to an inserted SD card can use the standard C functions fopen or fprintf to work with Espressif's virtual file drivers. Visit Espressif's virtual <a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/storage/vfs.html">file system component</a> docs for usage.</p>
<p>The example code below, mounts the SD card and then writes a file named <code>hello.txt</code> on the path <code>/sdcard</code> with the contents "Hello &lt;&lt;YOUR SD CARD'S PRODUCT NAME&gt;&gt;!":</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#define MOUNT_POINT &quot;/sdcard&quot;</span></div>
<div class="line">sdmmc_card_t* card;</div>
<div class="line">esp_err_t err;</div>
<div class="line"> </div>
<div class="line">xSemaphoreTake(<a class="code" href="disp__spi_8h.html#a76c0525d646735793add25b18043e600">spi_mutex</a>, portMAX_DELAY);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="disp__spi_8h.html#a3dc6a7525e5a0b34e37a3a64478ec9ee">spi_poll</a>();</div>
<div class="line"> </div>
<div class="line">err = Core2ForAWS_Sdcard_Mount(MOUNT_POINT, &amp;card);</div>
<div class="line"> </div>
<div class="line">FILE* f = fopen(MOUNT_POINT<span class="stringliteral">&quot;/hello.txt&quot;</span>, <span class="stringliteral">&quot;w+&quot;</span>)</div>
<div class="line">fprintf(f, &quot;Hello %s!\n&quot;, card-&gt;cid.name);</div>
<div class="line">fclose(f);</div>
<div class="line"> </div>
<div class="line">xSemaphoreGive(<a class="code" href="disp__spi_8h.html#a76c0525d646735793add25b18043e600">spi_mutex</a>);</div>
<div class="ttc" id="adisp__spi_8h_html_a3dc6a7525e5a0b34e37a3a64478ec9ee"><div class="ttname"><a href="disp__spi_8h.html#a3dc6a7525e5a0b34e37a3a64478ec9ee">spi_poll</a></div><div class="ttdeci">void spi_poll()</div><div class="ttdoc">Polls the SPI bus for a pending SPI transaction to complete.</div><div class="ttdef"><b>Definition:</b> disp_spi.c:34</div></div>
<div class="ttc" id="adisp__spi_8h_html_a76c0525d646735793add25b18043e600"><div class="ttname"><a href="disp__spi_8h.html#a76c0525d646735793add25b18043e600">spi_mutex</a></div><div class="ttdeci">SemaphoreHandle_t spi_mutex</div><div class="ttdoc">Semaphore for the shared SPI bus.</div><div class="ttdef"><b>Definition:</b> disp_spi.c:21</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mount_path</td><td>The path where partition should be registered. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_card</td><td>The pointer to the card information structure. Hold this handle and use it to unmount the card later if needed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/system/esp_err.html#macros">esp_err_t</a>. 0 or <code>ESP_OK</code> if successful. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
