<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core2 for AWS IoT Kit BSP: Power</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8V9B1GPE56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8V9B1GPE56');
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AWS_logo_RGB.png"/></td>
  <td id="projectalign">
   <div id="projectname">Core2 for AWS IoT Kit BSP<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Power </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The power library provides convenience functions to interact with the AXP192 power management unit (PMU). The <a class="el" href="core2foraws__power_8h.html#a302fed63335a354174b0c8e760ed055e">core2foraws_power_init</a> initialization function or <a class="el" href="core2foraws_8h.html#a8589c127068e67d5474515365b558051">core2foraws_init</a> wrapper function configures the Espressif ESP-IDF I2C driver with the thread-safe ropg <a href="https://github.com/ropg/i2c_manager">i2c_manager</a> to communicate with the PMU. There are some convenience functions for controlling on-board peripherals (e.g. vibration motor, green LED, display backlight).</p>
<p ><a class="anchor" id="power_library"></a></p>
<dl class="section warning"><dt>Warning</dt><dd>Writing to the PMU registers directly can render the device inoperable. This is recommended only for advanced users.</dd></dl>
<p><a href="./block_diagram-axp192.png"><img src="./block_diagram-axp192.png" alt="Circuit Block Diagram for AXP192 power management unit" class="center" class="inline"/></a></p>
<p >To enable the BSP hardware features, open the KConfig menu using the command <code>pio run --environment core2foraws --target menuconfig</code> from within the root of the project directory in your <a href="/en/blinky-hello-world/prerequisites.html#open-the-platformio-cli-terminal-window">PlatformIO terminal window</a> and go to the menu <code>Component Config --&gt; Core2 for AWS hardware features</code> to set the features you want to enable.</p>
<h1><a class="anchor" id="power_example"></a>
Example</h1>
<p >The following example initializes the Core2 for AWS, which initializes a number of enabled features, including the power management unit (PMU). It then turns on the green LED (on the bottom, next to reset button), prints the the battery voltage and if the device is plugged in using the ESP logger.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;esp_log.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="core2foraws_8h.html">core2foraws.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *TAG = <span class="stringliteral">&quot;POWER_EXAMPLE&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> app_main( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="core2foraws_8h.html#a8589c127068e67d5474515365b558051">core2foraws_init</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="core2foraws__power_8h.html#ab4e6ec89174bbc0122b8cbd20f746113">core2foraws_power_led_enable</a>( <span class="keyword">true</span> );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> battery_voltage = <a class="code hl_function" href="core2foraws__power_8h.html#a6c853352eab1b04f7a8c1aa6766ca7bd">core2foraws_power_batt_volts_get</a>();</div>
<div class="line">    ESP_LOGI( TAG, <span class="stringliteral">&quot;Battery Voltage: %.3f&quot;</span>, battery_voltage );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> plugged_in = <span class="keyword">false</span>;</div>
<div class="line">    <a class="code hl_function" href="core2foraws__power_8h.html#a0193ae0722a246eac3614b6972f079de">core2foraws_power_plugged_get</a>( &amp;plugged_in );</div>
<div class="line">    ESP_LOGI( TAG, <span class="stringliteral">&quot;Device is %s&quot;</span>, plugged_in ? <span class="stringliteral">&quot;plugged in&quot;</span> : <span class="stringliteral">&quot;not plugged in&quot;</span> );</div>
<div class="line">}</div>
<div class="ttc" id="acore2foraws_8h_html"><div class="ttname"><a href="core2foraws_8h.html">core2foraws.h</a></div><div class="ttdoc">Core2 for AWS IoT Kit general hardware driver APIs.</div></div>
<div class="ttc" id="acore2foraws_8h_html_a8589c127068e67d5474515365b558051"><div class="ttname"><a href="core2foraws_8h.html#a8589c127068e67d5474515365b558051">core2foraws_init</a></div><div class="ttdeci">esp_err_t core2foraws_init(void)</div><div class="ttdoc">Initializes enabled hardware features.</div></div>
<div class="ttc" id="acore2foraws__power_8h_html_a0193ae0722a246eac3614b6972f079de"><div class="ttname"><a href="core2foraws__power_8h.html#a0193ae0722a246eac3614b6972f079de">core2foraws_power_plugged_get</a></div><div class="ttdeci">esp_err_t core2foraws_power_plugged_get(bool *status)</div><div class="ttdoc">Get status of the device being plugged in to external power source from the power management unit (PM...</div></div>
<div class="ttc" id="acore2foraws__power_8h_html_a6c853352eab1b04f7a8c1aa6766ca7bd"><div class="ttname"><a href="core2foraws__power_8h.html#a6c853352eab1b04f7a8c1aa6766ca7bd">core2foraws_power_batt_volts_get</a></div><div class="ttdeci">esp_err_t core2foraws_power_batt_volts_get(float *volts)</div><div class="ttdoc">Get the battery voltage value from the power management unit (PMU).</div></div>
<div class="ttc" id="acore2foraws__power_8h_html_ab4e6ec89174bbc0122b8cbd20f746113"><div class="ttname"><a href="core2foraws__power_8h.html#ab4e6ec89174bbc0122b8cbd20f746113">core2foraws_power_led_enable</a></div><div class="ttdeci">esp_err_t core2foraws_power_led_enable(bool state)</div><div class="ttdoc">Sets the green LED on the bottom of the device on or off.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="power_preprocessor_macros"></a>
Pre-processor Macro Definitions</h1>
<ul>
<li><a class="el" href="power_rail_esp32_macro.html">POWER_RAIL_ESP32</a> <br  />
</li>
<li><a class="el" href="power_rail_logic_and_sd_macro.html">POWER_RAIL_LOGIC_AND_SD</a> <br  />
</li>
<li><a class="el" href="power_rail_vibrator_macro.html">POWER_RAIL_VIBRATOR</a> <br  />
</li>
<li><a class="el" href="power_rail_display_backlight_macro.html">POWER_RAIL_DISPLAY_BACKLIGHT</a> <br  />
</li>
<li><a class="el" href="display_backlight_start_macro.html">DISPLAY_BACKLIGHT_START</a> <br  />
</li>
<li><a class="el" href="display_backlight_min_volts_macro.html">DISPLAY_BACKLIGHT_MIN_VOLTS</a> <br  />
</li>
<li><a class="el" href="display_backlight_max_volts_macro.html">DISPLAY_BACKLIGHT_MAX_VOLTS</a> <br  />
</li>
</ul>
<h1><a class="anchor" id="power_enumerated_type_definitions"></a>
Enumerated Type Definitions</h1>
<ul>
<li><a class="el" href="power_rail_t_enum.html">power_rail_t</a></li>
</ul>
<h1><a class="anchor" id="axp192_functions"></a>
Functions</h1>
<ul>
<li><a class="el" href="core2foraws_power_init_function.html">core2foraws_power_init</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_backlight_set_function.html">core2foraws_power_backlight_set</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_led_enable_function.html">core2foraws_power_led_enable</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_vibration_enable_function.html">core2foraws_power_vibration_enable</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_speaker_enable_function.html">core2foraws_power_speaker_enable</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_batt_volts_get_function.html">core2foraws_power_batt_volts_get</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_batt_current_get_function.html">core2foraws_power_batt_current_get</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_charging_get_function.html">core2foraws_power_charging_get</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_plugged_get_function.html">core2foraws_power_plugged_get</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_axp_reg_get_function.html">core2foraws_power_axp_reg_get</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_axp_reg_set_function.html">core2foraws_power_axp_reg_set</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_axp_read_function.html">core2foraws_power_axp_read</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_axp_twiddle_function.html">core2foraws_power_axp_twiddle</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_rail_state_get_function.html">core2foraws_power_rail_state_get</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_rail_state_set_function.html">core2foraws_power_rail_state_set</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_rail_mv_get_function.html">core2foraws_power_rail_mv_get</a> <br  />
</li>
<li><a class="el" href="core2foraws_power_rail_mv_set_function.html">core2foraws_power_rail_mv_set</a> <br  />
 </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
