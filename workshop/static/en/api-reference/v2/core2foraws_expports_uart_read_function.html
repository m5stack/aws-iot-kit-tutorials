<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core2 for AWS IoT Kit BSP: core2foraws_expports_uart_read</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8V9B1GPE56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8V9B1GPE56');
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AWS_logo_RGB.png"/></td>
  <td id="projectalign">
   <div id="projectname">Core2 for AWS IoT Kit BSP<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="expports.html">External Grove Connector Expansion Ports</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">core2foraws_expports_uart_read </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line">esp_err_t <a class="code hl_function" href="core2foraws__expports_8h.html#a7c96905f03597b16aa851d5a4ba05bec">core2foraws_expports_uart_read</a>( uint8_t *message_buffer, <span class="keywordtype">size_t</span> *was_read_length );</div>
<div class="ttc" id="acore2foraws__expports_8h_html_a7c96905f03597b16aa851d5a4ba05bec"><div class="ttname"><a href="core2foraws__expports_8h.html#a7c96905f03597b16aa851d5a4ba05bec">core2foraws_expports_uart_read</a></div><div class="ttdeci">esp_err_t core2foraws_expports_uart_read(uint8_t *message_buffer, size_t *was_read_length)</div><div class="ttdoc">Read bytes from the UART2 interface through PORT_C_UART_RX_PIN (GPIO 13).</div></div>
</div><!-- fragment --><p> Read bytes from the UART2 interface through <a class="el" href="core2foraws__expports_8h.html#a1d7f3c77703d9c2c8654700f05f04f81">PORT_C_UART_RX_PIN</a> (GPIO 13).</p>
<p >This is a helper function to simplify building applications with UART using 8 bit word length, no parity bit, 1 bit for the stop bit, and hardware flow control disabled. It sets the baud rate to the user defined value and starts reading from the UART channel 2 and storing data into the ring buffer of length <a class="el" href="core2foraws__expports_8h.html#a1f25fe45d891de244a8135ae02fc9265">UART_RX_BUF_SIZE</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Usage of the UART convenience methods provided in this BSP aims to simplify development at the expense of compatibility and performance. The configuration above may not be suitable for your application or attached peripheral. For more information about UART communications on the Core2 for AWS IoT Kit using the ESP32 and how to create your own configuration, visit Espressif's official <a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/peripherals/uart.html">documentation</a>.</dd>
<dd>
The ESP32 is a 3.3v device and requires 3.3v on the UART TX/RX lines. Higher voltages requires the use of a level shifter.</dd></dl>
<p><b>Example:</b></p>
<p >The example below sets <a class="el" href="core2foraws__expports_8h.html#a8764a8d2c486f2d66f86d995653cc833">PORT_C_UART_TX_PIN</a> (GPIO 14 to transmit) and PORT_C_UART_RX_PIN (GPIO 13 to receive), and sets the UART baud rate to 115200. It then starts two FreeRTOS tasks â€” one that transmits "Hello from AWS IoT Kit" every two seconds and the other receives the message. The receiver task outputs the number of bytes read from the buffer, the number of bytes that remains unread in the ring buffer, and the message.</p>
<dl class="section note"><dt>Note</dt><dd>To receive the messages transmitted on the same device, run a female-female jumper wire from Port C's TX pin to PORT C's RX pin. <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;freertos/FreeRTOS.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;freertos/task.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;esp_log.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="core2foraws_8h.html">core2foraws.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *TAG = <span class="stringliteral">&quot;MAIN_UART_DEMO&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uart_tx_task( <span class="keywordtype">void</span> *pvParameters )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> ( 1 )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *message = <span class="stringliteral">&quot;Hello from AWS IoT Kit&quot;</span>;</div>
<div class="line">        <span class="keywordtype">size_t</span> message_len = strlen( message ) + 1;</div>
<div class="line">        <span class="keywordtype">size_t</span> written_len = 0;</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="core2foraws__expports_8h.html#adb85176507045a1bdd8e23925b0fc5ba">core2foraws_expports_uart_write</a>( message, message_len, &amp;written_len );</div>
<div class="line">        ESP_LOGI( TAG, <span class="stringliteral">&quot;\tWrote %d out of % bytes&quot;</span>, written_len, message_len );</div>
<div class="line"> </div>
<div class="line">        vTaskDelay( pdMS_TO_TICKS( 2000 ) );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uart_rx_task( <span class="keywordtype">void</span> *arg )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> rxBytes;</div>
<div class="line">    uint8_t *data = heap_caps_malloc( <a class="code hl_define" href="core2foraws__expports_8h.html#a1f25fe45d891de244a8135ae02fc9265">UART_RX_BUF_SIZE</a>, MALLOC_CAP_SPIRAM ); <span class="comment">// Allocate space for message in external RAM</span></div>
<div class="line">    <span class="keywordflow">while</span> ( 1 )</div>
<div class="line">    {</div>
<div class="line">        esp_err_t err = <a class="code hl_function" href="core2foraws__expports_8h.html#a7c96905f03597b16aa851d5a4ba05bec">core2foraws_expports_uart_read</a>( data, &amp;rxBytes );</div>
<div class="line">        <span class="keywordflow">if</span> ( err == ESP_OK )</div>
<div class="line">        {</div>
<div class="line">            ESP_LOGI( TAG, <span class="stringliteral">&quot;\tRead %d bytes from UART. Received: &#39;%s&#39;&quot;</span>, rxBytes, data );</div>
<div class="line">        }</div>
<div class="line">        vTaskDelay( pdMS_TO_TICKS( 500 ) ); <span class="comment">// Read more frequently than transmit to ensure the messages are not erased from buffer.</span></div>
<div class="line">    }</div>
<div class="line">    free(data); <span class="comment">// Free memory from external RAM</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> app_main( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="core2foraws_8h.html#a8589c127068e67d5474515365b558051">core2foraws_init</a>();</div>
<div class="line">    esp_err_t err = ESP_FAIL;</div>
<div class="line">    err = <a class="code hl_function" href="core2foraws__expports_8h.html#ac52e3b43d38555f0ed5e1f315e2ed274">core2foraws_expports_uart_begin</a>( 115200 );</div>
<div class="line">    <span class="keywordflow">if</span> ( err == ESP_OK )</div>
<div class="line">    {</div>
<div class="line">        xTaskCreatePinnedToCore( uart_rx_task, <span class="stringliteral">&quot;uart_rx&quot;</span>, 1024*2, NULL, configMAX_PRIORITIES-2, NULL, 1);</div>
<div class="line">        xTaskCreatePinnedToCore( uart_tx_task, <span class="stringliteral">&quot;uart_tx&quot;</span>, 1024*2, NULL, configMAX_PRIORITIES-3, NULL, 1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="acore2foraws_8h_html"><div class="ttname"><a href="core2foraws_8h.html">core2foraws.h</a></div><div class="ttdoc">Core2 for AWS IoT Kit general hardware driver APIs.</div></div>
<div class="ttc" id="acore2foraws_8h_html_a8589c127068e67d5474515365b558051"><div class="ttname"><a href="core2foraws_8h.html#a8589c127068e67d5474515365b558051">core2foraws_init</a></div><div class="ttdeci">esp_err_t core2foraws_init(void)</div><div class="ttdoc">Initializes enabled hardware features.</div></div>
<div class="ttc" id="acore2foraws__expports_8h_html_a1f25fe45d891de244a8135ae02fc9265"><div class="ttname"><a href="core2foraws__expports_8h.html#a1f25fe45d891de244a8135ae02fc9265">UART_RX_BUF_SIZE</a></div><div class="ttdeci">#define UART_RX_BUF_SIZE</div><div class="ttdoc">The default UART RX ring buffer size.</div><div class="ttdef"><b>Definition:</b> core2foraws_expports.h:140</div></div>
<div class="ttc" id="acore2foraws__expports_8h_html_ac52e3b43d38555f0ed5e1f315e2ed274"><div class="ttname"><a href="core2foraws__expports_8h.html#ac52e3b43d38555f0ed5e1f315e2ed274">core2foraws_expports_uart_begin</a></div><div class="ttdeci">esp_err_t core2foraws_expports_uart_begin(uint32_t baud)</div><div class="ttdoc">Configures the UART interface on for PORT_C_UART_RX_PIN (GPIO 13) and PORT_C_UART_TX_PIN (GPIO 14) at...</div></div>
<div class="ttc" id="acore2foraws__expports_8h_html_adb85176507045a1bdd8e23925b0fc5ba"><div class="ttname"><a href="core2foraws__expports_8h.html#adb85176507045a1bdd8e23925b0fc5ba">core2foraws_expports_uart_write</a></div><div class="ttdeci">esp_err_t core2foraws_expports_uart_write(const char *message, size_t length, size_t *was_written_length)</div><div class="ttdoc">Writes message to the UART2 interface through PORT_C_UART_TX_PIN (GPIO 14).</div></div>
</div><!-- fragment --></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">message_buffer</td><td>A pointer to the buffer read from UART2. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">was_read_length</td><td>Pointer to the number of bytes read from <a class="el" href="core2foraws__expports_8h.html#a1d7f3c77703d9c2c8654700f05f04f81">PORT_C_UART_RX_PIN</a> (GPIO 13). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/system/esp_err.html#macros">esp_err_t</a>.<ul>
<li>ESP_OK : Success</li>
<li>ESP_FAIL : Failed to write </li>
</ul>
</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
