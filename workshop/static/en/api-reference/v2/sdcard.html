<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core2 for AWS IoT Kit BSP: SD-Card</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8V9B1GPE56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8V9B1GPE56');
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AWS_logo_RGB.png"/></td>
  <td id="projectalign">
   <div id="projectname">Core2 for AWS IoT Kit BSP<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SD-Card </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The SD Card functions wraps Espressif's virtual file drivers for the SD card slot. Reading/writing to an inserted SD card can use the standard C functions fopen or fprintf. The SD Card must be unmounted before removing if the device is on to avoid data corruption. Visit Espressif's virtual <a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/storage/vfs.html">file system component</a> docs for usage. Maximum supported SD is 16GB and requires the use of a FAT/FAT32 partition table.</p>
<p ><a class="anchor" id="sd_library"></a></p>
<p ><a href="./block_diagram-sdcard.png"><img src="./block_diagram-sdcard.png" alt="Circuit Block Diagram for the SD card slot" class="center" class="inline"/></a></p>
<p >To enable the BSP hardware features, open the KConfig menu using the command <code>pio run --environment core2foraws --target menuconfig</code> from within the root of the project directory in your <a href="/en/blinky-hello-world/prerequisites.html#open-the-platformio-cli-terminal-window">PlatformIO terminal window</a> and go to the menu <code>Component Config --&gt; Core2 for AWS hardware features</code> to set the features you want to enable.</p>
<p >The SD card and the screen share the SPI bus with their own Chip Select (CS) pin. Writing data to the SD card will block writes to the screen and vice versa through the implemented mutex.</p>
<h1><a class="anchor" id="sdcard_example"></a>
Example</h1>
<p >The example code below, mounts the SD card, writes a file named <code>edukit.txt</code> with the contents "Hello from AWS IoT 
Kit!", reads back the file and outputs the contents using the ESP logger, and then unmounts the card for safe removal:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;esp_log.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="core2foraws__sd_8h.html">lib/sd/include/core2foraws_sd.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *TAG = <span class="stringliteral">&quot;SDCARD_EXAMPLE&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> app_main( <span class="keywordtype">void</span> *pvParameters )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *file_path = <span class="stringliteral">&quot;/edukit.txt&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    esp_err_t err = <a class="code hl_function" href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a>();</div>
<div class="line">    ESP_LOGI( TAG, <span class="stringliteral">&quot;\tMounted SD %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> length = 0;</div>
<div class="line">    err = <a class="code hl_function" href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">core2foraws_sd_write</a>( file_path, <span class="stringliteral">&quot;Hello from AWS IoT Kit!&quot;</span>, &amp;length );</div>
<div class="line">    ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD write %s, wrote %d bytes&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, length );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> str[64];</div>
<div class="line">    err = <a class="code hl_function" href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">core2foraws_sd_read</a>( file_path, str, 64 );</div>
<div class="line">    ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD read %s,\nString read: %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, str );</div>
<div class="line"> </div>
<div class="line">    err = <a class="code hl_function" href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">core2foraws_sd_unmount</a>();</div>
<div class="line">    ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD unmount %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
<div class="line">}</div>
<div class="ttc" id="acore2foraws__sd_8h_html"><div class="ttname"><a href="core2foraws__sd_8h.html">core2foraws_sd.h</a></div><div class="ttdoc">Core2 for AWS IoT Kit SD card hardware driver APIs.</div></div>
<div class="ttc" id="acore2foraws__sd_8h_html_a2c982e6ffede331f83569ebfc1e47d9e"><div class="ttname"><a href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">core2foraws_sd_write</a></div><div class="ttdeci">esp_err_t core2foraws_sd_write(const char *file_name, const char *message, size_t *wrote_length)</div><div class="ttdoc">Writes a specified string to the specificied file on the SD card.</div></div>
<div class="ttc" id="acore2foraws__sd_8h_html_a6def4d4dd9cf2e8bff43748b2221f592"><div class="ttname"><a href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">core2foraws_sd_read</a></div><div class="ttdeci">esp_err_t core2foraws_sd_read(const char *file_name, char *message, size_t to_read_length)</div><div class="ttdoc">Reads a specified length of characters from the specificied file on the FAT file system SD card.</div></div>
<div class="ttc" id="acore2foraws__sd_8h_html_aaff3b291da98d385216d004a5525d2e0"><div class="ttname"><a href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">core2foraws_sd_unmount</a></div><div class="ttdeci">esp_err_t core2foraws_sd_unmount(void)</div><div class="ttdoc">Removes the FAT partition and unmounts the SD-Card. Unmount before removing SD card from the device.</div></div>
<div class="ttc" id="acore2foraws__sd_8h_html_acb7ac539ff13520aba1c3b84025aae76"><div class="ttname"><a href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a></div><div class="ttdeci">esp_err_t core2foraws_sd_mount(void)</div><div class="ttdoc">Initializes and mounts the SD card.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="sd_preprocessor_macros"></a>
Preprocessor Macros</h1>
<ul>
<li><a class="el" href="sd_access_delay_ms_macro.html">SD_ACCESS_DELAY_MS</a> <br  />
</li>
</ul>
<h1><a class="anchor" id="sdcard_functions"></a>
Functions</h1>
<ul>
<li><a class="el" href="core2foraws_sd_mount_function.html">core2foraws_sd_mount</a> <br  />
</li>
<li><a class="el" href="core2foraws_sd_read_function.html">core2foraws_sd_read</a> <br  />
</li>
<li><a class="el" href="core2foraws_sd_unmount_function.html">core2foraws_sd_unmount</a> <br  />
 </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
