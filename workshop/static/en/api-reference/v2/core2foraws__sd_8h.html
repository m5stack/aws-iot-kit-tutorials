<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core2 for AWS IoT EduKit BSP: core2foraws_sd.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AWS_logo_RGB.png"/></td>
  <td id="projectalign">
   <div id="projectname">Core2 for AWS IoT EduKit BSP<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b4313104a230dd94f699539f8e438d9b.html">Core2-for-AWS-IoT-EduKit</a></li><li class="navelem"><a class="el" href="dir_75a483a8633115123af46fb2bb05dd34.html">lib</a></li><li class="navelem"><a class="el" href="dir_eb8c6296007a3a57ce0ca65a48185c68.html">sd</a></li><li class="navelem"><a class="el" href="dir_fe230bc5f4c115ed1b9a01869b6f09d0.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">core2foraws_sd.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Core2 for AWS IoT EduKit SD card hardware driver APIs.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;freertos/FreeRTOS.h&gt;</code><br />
<code>#include &lt;driver/gpio.h&gt;</code><br />
<code>#include &lt;esp_freertos_hooks.h&gt;</code><br />
<code>#include &lt;esp_vfs_fat.h&gt;</code><br />
<code>#include &lt;sdmmc_cmd.h&gt;</code><br />
<code>#include &lt;esp_err.h&gt;</code><br />
</div>
<p><a href="core2foraws__sd_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a4538aabf263e963be1be8e1b0e2a2a11"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core2foraws__sd_8h.html#a4538aabf263e963be1be8e1b0e2a2a11">SD_ACCESS_DELAY_MS</a>&#160;&#160;&#160;100U</td></tr>
<tr class="memdesc:a4538aabf263e963be1be8e1b0e2a2a11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay time added to SD card operations.  <a href="core2foraws__sd_8h.html#a4538aabf263e963be1be8e1b0e2a2a11">More...</a><br /></td></tr>
<tr class="separator:a4538aabf263e963be1be8e1b0e2a2a11"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acb7ac539ff13520aba1c3b84025aae76"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a> (void)</td></tr>
<tr class="memdesc:acb7ac539ff13520aba1c3b84025aae76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes and mounts the SD card.  <a href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">More...</a><br /></td></tr>
<tr class="separator:acb7ac539ff13520aba1c3b84025aae76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6def4d4dd9cf2e8bff43748b2221f592"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">core2foraws_sd_read</a> (const char *file_name, char *message, size_t to_read_length)</td></tr>
<tr class="memdesc:a6def4d4dd9cf2e8bff43748b2221f592"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a specified length of characters from the specificied file on the FAT file system SD card.  <a href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">More...</a><br /></td></tr>
<tr class="separator:a6def4d4dd9cf2e8bff43748b2221f592"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c982e6ffede331f83569ebfc1e47d9e"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">core2foraws_sd_write</a> (const char *file_name, const char *message, size_t *wrote_length)</td></tr>
<tr class="memdesc:a2c982e6ffede331f83569ebfc1e47d9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a specified string to the specificied file on the SD card.  <a href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">More...</a><br /></td></tr>
<tr class="separator:a2c982e6ffede331f83569ebfc1e47d9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaff3b291da98d385216d004a5525d2e0"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">core2foraws_sd_unmount</a> (void)</td></tr>
<tr class="memdesc:aaff3b291da98d385216d004a5525d2e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes the FAT partition and unmounts the SD-Card. Unmount before removing SD card from the device.  <a href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">More...</a><br /></td></tr>
<tr class="separator:aaff3b291da98d385216d004a5525d2e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Core2 for AWS IoT EduKit SD card hardware driver APIs. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4538aabf263e963be1be8e1b0e2a2a11" name="a4538aabf263e963be1be8e1b0e2a2a11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4538aabf263e963be1be8e1b0e2a2a11">&#9670;&nbsp;</a></span>SD_ACCESS_DELAY_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_ACCESS_DELAY_MS&#160;&#160;&#160;100U</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delay time added to SD card operations. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="acb7ac539ff13520aba1c3b84025aae76" name="acb7ac539ff13520aba1c3b84025aae76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb7ac539ff13520aba1c3b84025aae76">&#9670;&nbsp;</a></span>core2foraws_sd_mount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t core2foraws_sd_mount </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes and mounts the SD card. </p>
<dl class="section note"><dt>Note</dt><dd>The SD card must be mounted before use. The SD card and the screen share the same SPI bus, with each device having it's own CS line. Frequent writes to the SD card can cause slow down of the screen writes. In order to protect access to the device, a mutex has been placed for each of SD card APIs to make it thread-safe in the event there are multiple tasks attempting to access the device at once.</dd></dl>
<p>The example code below mounts the SD card on the mount point <code>/sdcard</code> and then writes a file named <code>edukit.txt</code> with the contents "Hello from AWS IoT EduKit!":</p>
<p ><b>Example:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> *mount_point = <span class="stringliteral">&quot;/sdcard&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> *file_path = <span class="stringliteral">&quot;/edukit.txt&quot;</span>;</div>
<div class="line"> </div>
<div class="line">esp_err_t err = <a class="code hl_function" href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a>( mount_point );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tMounted SD %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> written_length = 0;</div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">core2foraws_sd_write</a>( mount_point, file_path, <span class="stringliteral">&quot;Hello from AWS IoT EduKit!&quot;</span>, &amp;length );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD write %s, wrote %d bytes&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, written_length );</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> str[64];</div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">core2foraws_sd_read</a>( mount_point, file_path, str, 64 );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD read %s,\nString: %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, str );</div>
<div class="line"> </div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">core2foraws_sd_unmount</a>( mount_point );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD unmount %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
<div class="ttc" id="acore2foraws__sd_8h_html_a2c982e6ffede331f83569ebfc1e47d9e"><div class="ttname"><a href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">core2foraws_sd_write</a></div><div class="ttdeci">esp_err_t core2foraws_sd_write(const char *file_name, const char *message, size_t *wrote_length)</div><div class="ttdoc">Writes a specified string to the specificied file on the SD card.</div></div>
<div class="ttc" id="acore2foraws__sd_8h_html_a6def4d4dd9cf2e8bff43748b2221f592"><div class="ttname"><a href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">core2foraws_sd_read</a></div><div class="ttdeci">esp_err_t core2foraws_sd_read(const char *file_name, char *message, size_t to_read_length)</div><div class="ttdoc">Reads a specified length of characters from the specificied file on the FAT file system SD card.</div></div>
<div class="ttc" id="acore2foraws__sd_8h_html_aaff3b291da98d385216d004a5525d2e0"><div class="ttname"><a href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">core2foraws_sd_unmount</a></div><div class="ttdeci">esp_err_t core2foraws_sd_unmount(void)</div><div class="ttdoc">Removes the FAT partition and unmounts the SD-Card. Unmount before removing SD card from the device.</div></div>
<div class="ttc" id="acore2foraws__sd_8h_html_acb7ac539ff13520aba1c3b84025aae76"><div class="ttname"><a href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a></div><div class="ttdeci">esp_err_t core2foraws_sd_mount(void)</div><div class="ttdoc">Initializes and mounts the SD card.</div></div>
</div><!-- fragment --><dl class="section return"><dt>Returns</dt><dd><a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/system/esp_err.html#macros">esp_err_t</a>.<ul>
<li>ESP_OK : Success</li>
<li>ESP_FAIL : Failed to mount the SD card </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a6def4d4dd9cf2e8bff43748b2221f592" name="a6def4d4dd9cf2e8bff43748b2221f592"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6def4d4dd9cf2e8bff43748b2221f592">&#9670;&nbsp;</a></span>core2foraws_sd_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t core2foraws_sd_read </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>to_read_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads a specified length of characters from the specificied file on the FAT file system SD card. </p>
<dl class="section note"><dt>Note</dt><dd>The SD card must be mounted before use and formatted with a FAT/FAT32 file system. The <code>to_read_length</code> can be higher than the total number of characters in the file. The function will return once the EOF character is read.</dd></dl>
<p>The example code below mounts the SD card on the mount point <code>/sdcard</code> and then writes a file named <code>edukit.txt</code> with the contents "Hello from AWS IoT EduKit!":</p>
<p ><b>Example:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> *mount_point = <span class="stringliteral">&quot;/sdcard&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> *file_path = <span class="stringliteral">&quot;/edukit.txt&quot;</span>;</div>
<div class="line"> </div>
<div class="line">esp_err_t err = <a class="code hl_function" href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a>( mount_point );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tMounted SD %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> written_length = 0;</div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">core2foraws_sd_write</a>( mount_point, file_path, <span class="stringliteral">&quot;Hello from AWS IoT EduKit!&quot;</span>, &amp;length );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD write %s, wrote %d bytes&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, written_length );</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> str[64];</div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">core2foraws_sd_read</a>( mount_point, file_path, str, 64 );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD read %s,\nString: %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, str );</div>
<div class="line"> </div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">core2foraws_sd_unmount</a>( mount_point );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD unmount %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">file_name</td><td>The pointer to the file name. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">message</td><td>The string read and copied from the file on the SD card. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">to_read_length</td><td>The number of characters to read from the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/system/esp_err.html#macros">esp_err_t</a>.<ul>
<li>ESP_OK : Success</li>
<li>ESP_FAIL : Failed to read file from SD </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a2c982e6ffede331f83569ebfc1e47d9e" name="a2c982e6ffede331f83569ebfc1e47d9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c982e6ffede331f83569ebfc1e47d9e">&#9670;&nbsp;</a></span>core2foraws_sd_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t core2foraws_sd_write </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>wrote_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes a specified string to the specificied file on the SD card. </p>
<dl class="section note"><dt>Note</dt><dd>The SD card must be mounted before use and formatted with a FAT/FAT32 file system.</dd></dl>
<p>The example code below mounts the SD card on the mount point <code>/sdcard</code> and then writes a file named <code>edukit.txt</code> with the contents "Hello from AWS IoT EduKit!":</p>
<p ><b>Example:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> *mount_point = <span class="stringliteral">&quot;/sdcard&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> *file_path = <span class="stringliteral">&quot;/edukit.txt&quot;</span>;</div>
<div class="line"> </div>
<div class="line">esp_err_t err = <a class="code hl_function" href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a>( mount_point );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tMounted SD %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> written_length = 0;</div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#a2c982e6ffede331f83569ebfc1e47d9e">core2foraws_sd_write</a>( mount_point, file_path, <span class="stringliteral">&quot;Hello from AWS IoT EduKit!&quot;</span>, &amp;length );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD write %s, wrote %d bytes&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, written_length );</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> str[64];</div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#a6def4d4dd9cf2e8bff43748b2221f592">core2foraws_sd_read</a>( mount_point, file_path, str, 64 );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD read %s,\nString: %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, str );</div>
<div class="line"> </div>
<div class="line">err = <a class="code hl_function" href="core2foraws__sd_8h.html#aaff3b291da98d385216d004a5525d2e0">core2foraws_sd_unmount</a>( mount_point );</div>
<div class="line">ESP_LOGI( TAG, <span class="stringliteral">&quot;\tSD unmount %s&quot;</span>, err == ESP_OK ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span> );</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">file_name</td><td>The pointer to the file name. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>The pointer to the string to write to the file on the SD card. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">wrote_length</td><td>The pointer to the number of characters that was written to the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/system/esp_err.html#macros">esp_err_t</a>.<ul>
<li>ESP_OK : Success</li>
<li>ESP_FAIL : Failed to write to SD card </li>
</ul>
</dd></dl>

</div>
</div>
<a id="aaff3b291da98d385216d004a5525d2e0" name="aaff3b291da98d385216d004a5525d2e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaff3b291da98d385216d004a5525d2e0">&#9670;&nbsp;</a></span>core2foraws_sd_unmount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t core2foraws_sd_unmount </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes the FAT partition and unmounts the SD-Card. Unmount before removing SD card from the device. </p>
<dl class="section note"><dt>Note</dt><dd>The SD Card must be mounted before use. The SD card and the screen uses the same SPI bus. In order to avoid conflicts with the screen, you must take the spi_mutex semaphore, then call spi_poll() before accessing the SD card. Once done, give/free the semaphore so the display can take it. The display task will then continue to update the display controller on the SPI bus.</dd></dl>
<p>To learn more about using the SD card, visit Espressif's virtual <a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/storage/vfs.html">file system component</a> docs for usage.</p>
<p >The example code below, mounts the SD card, writes a file named <code>hello.txt</code> on the path <code>/sdcard</code> with the contents "Hello
&lt;&lt;YOUR SD CARD'S PRODUCT NAME&gt;&gt;!", and then unmounts the card:</p>
<p ><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#define MOUNT_POINT &quot;/sdcard&quot;</span></div>
<div class="line">sdmmc_card_t* card;</div>
<div class="line">esp_err_t err;</div>
<div class="line"> </div>
<div class="line">xSemaphoreTake(spi_mutex, portMAX_DELAY);</div>
<div class="line"> </div>
<div class="line">spi_poll();</div>
<div class="line"> </div>
<div class="line">err = Core2ForAWS_Sdcard_Mount(MOUNT_POINT, &amp;card);</div>
<div class="line"> </div>
<div class="line">FILE* f = fopen(MOUNT_POINT<span class="stringliteral">&quot;/hello.txt&quot;</span>, <span class="stringliteral">&quot;w+&quot;</span>)</div>
<div class="line">fprintf(f, &quot;Hello %s!\n&quot;, card-&gt;cid.name);</div>
<div class="line">fclose(f);</div>
<div class="line"> </div>
<div class="line">err = Core2ForAWS_Sdcard_Unmount(MOUNT_POINT, &amp;card);</div>
<div class="line">xSemaphoreGive(spi_mutex);</div>
</div><!-- fragment --><dl class="section return"><dt>Returns</dt><dd><a href="https://docs.espressif.com/projects/esp-idf/en/release-v4.2/esp32/api-reference/system/esp_err.html#macros">esp_err_t</a>.<ul>
<li>ESP_OK : Success</li>
<li>ESP_ERR_INVALID_STATE : Failed to unmount. Must call <a class="el" href="core2foraws__sd_8h.html#acb7ac539ff13520aba1c3b84025aae76">core2foraws_sd_mount</a> first </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
