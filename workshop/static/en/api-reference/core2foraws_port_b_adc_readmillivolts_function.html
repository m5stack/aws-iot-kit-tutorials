<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core2 for AWS IoT Kit BSP: Core2ForAWS_Port_B_ADC_ReadMilliVolts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="AWS_logo_RGB.png"/></td>
  <td id="projectalign">
   <div id="projectname">Core2 for AWS IoT Kit BSP<span id="projectnumber">&#160;1.5.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="expports.html">External Grove Connector Expansion Ports</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Core2ForAWS_Port_B_ADC_ReadMilliVolts </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line">uint32_t <a class="code hl_function" href="core2for_a_w_s_8c.html#a297b6764c8ca7a522a15d7384756c285">Core2ForAWS_Port_B_ADC_ReadMilliVolts</a>(<span class="keywordtype">void</span>);</div>
<div class="ttc" id="acore2for_a_w_s_8c_html_a297b6764c8ca7a522a15d7384756c285"><div class="ttname"><a href="core2for_a_w_s_8c.html#a297b6764c8ca7a522a15d7384756c285">Core2ForAWS_Port_B_ADC_ReadMilliVolts</a></div><div class="ttdeci">uint32_t Core2ForAWS_Port_B_ADC_ReadMilliVolts(void)</div><div class="ttdoc">Read the calibrated ADC voltage from GPIO36.</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:538</div></div>
</div><!-- fragment --><p> Read the calibrated ADC voltage from GPIO36.</p>
<dl class="section note"><dt>Note</dt><dd>Uses the etched eFuse VRef calibration. </dd>
<dd>
pin_mode_t for PORT_B_ADC_PIN must be set to ADC before using Core2ForAWS_Port_B_ADC_ReadMilliVolts.</dd></dl>
<p>This function reads the raw ADC value from Port B's Analog-to-Digital-Converter (ADC) on GPIO36 and converts it to millivolts using the VRef calibration. GPIO36 is the only pin on the external ports with access to the ADC. Read more about using <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/adc.html">ADCs with the ESP-IDF</a>.</p>
<p >The example code sets the ADC pin mode for the PORT_B_ADC_PIN, creates a FreeRTOS task which periodically (1s) reads the ADC voltage of the <a href="https://shop.m5stack.com/products/earth-sensor-unit">M5Stack EARTH</a> moisture sensor connected on Port B. It prints out the value to the serial output.</p>
<p ><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/task.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;esp_log.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="core2for_a_w_s_8h.html">core2forAWS.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_define" href="i2c__device_8c.html#afc3d101f633a076cc1ca84b85b6224b2">TAG</a> = <span class="stringliteral">&quot;ADC_VOLTAGE_READ_DEMO&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> read_moisture_task(){</div>
<div class="line">    <span class="keywordflow">for</span>(;;){</div>
<div class="line">        ESP_LOGI(<a class="code hl_define" href="i2c__device_8c.html#afc3d101f633a076cc1ca84b85b6224b2">TAG</a>, <span class="stringliteral">&quot;Moisture ADC converted to voltage: %d&quot;</span>, <a class="code hl_function" href="core2for_a_w_s_8c.html#a297b6764c8ca7a522a15d7384756c285">Core2ForAWS_Port_B_ADC_ReadMilliVolts</a>());</div>
<div class="line">        vTaskDelay(pdMS_TO_TICKS(1000));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> app_main(<span class="keywordtype">void</span>){</div>
<div class="line">    <a class="code hl_function" href="core2for_a_w_s_8c.html#a3d850a3f56bbe0685b60726d8b53bece">Core2ForAWS_Init</a>();</div>
<div class="line">    esp_err_t err = <a class="code hl_function" href="core2for_a_w_s_8c.html#a20b1459685901f232474236d0fc6c23f">Core2ForAWS_Port_PinMode</a>(<a class="code hl_define" href="core2for_a_w_s_8h.html#acc191b4d5b52786c63d4692d6cb80d40">PORT_B_ADC_PIN</a>, <a class="code hl_enumvalue" href="core2for_a_w_s_8h.html#a77fecc1883f27c095012fbe56345c4dba5ec0e8ce4c96673614190a8852261f4f">ADC</a>);</div>
<div class="line">    <span class="keywordflow">if</span>(err == ESP_OK){</div>
<div class="line">        xTaskCreatePinnedToCore(read_moisture_task, <span class="stringliteral">&quot;moisture_voltage&quot;</span>, 1024*4, NULL, 1, NULL, 1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="acore2for_a_w_s_8c_html_a20b1459685901f232474236d0fc6c23f"><div class="ttname"><a href="core2for_a_w_s_8c.html#a20b1459685901f232474236d0fc6c23f">Core2ForAWS_Port_PinMode</a></div><div class="ttdeci">esp_err_t Core2ForAWS_Port_PinMode(gpio_num_t pin, pin_mode_t mode)</div><div class="ttdoc">Sets the pin mode of the specified pin.</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:431</div></div>
<div class="ttc" id="acore2for_a_w_s_8c_html_a3d850a3f56bbe0685b60726d8b53bece"><div class="ttname"><a href="core2for_a_w_s_8c.html#a3d850a3f56bbe0685b60726d8b53bece">Core2ForAWS_Init</a></div><div class="ttdeci">void Core2ForAWS_Init(void)</div><div class="ttdoc">Initializes the power chip with default values, enables battery charging, and initializes all enabled...</div><div class="ttdef"><b>Definition:</b> core2forAWS.c:32</div></div>
<div class="ttc" id="acore2for_a_w_s_8h_html"><div class="ttname"><a href="core2for_a_w_s_8h.html">core2forAWS.h</a></div><div class="ttdoc">Functions to initialize and access Core2 for AWS IoT Kit hardware features.</div></div>
<div class="ttc" id="acore2for_a_w_s_8h_html_a77fecc1883f27c095012fbe56345c4dba5ec0e8ce4c96673614190a8852261f4f"><div class="ttname"><a href="core2for_a_w_s_8h.html#a77fecc1883f27c095012fbe56345c4dba5ec0e8ce4c96673614190a8852261f4f">ADC</a></div><div class="ttdeci">@ ADC</div><div class="ttdoc">Enable ADC mode. Only available on Port Bâ€”GPIO 36.</div><div class="ttdef"><b>Definition:</b> core2forAWS.h:218</div></div>
<div class="ttc" id="acore2for_a_w_s_8h_html_acc191b4d5b52786c63d4692d6cb80d40"><div class="ttname"><a href="core2for_a_w_s_8h.html#acc191b4d5b52786c63d4692d6cb80d40">PORT_B_ADC_PIN</a></div><div class="ttdeci">#define PORT_B_ADC_PIN</div><div class="ttdoc">The ADC pin on expansion port B.</div><div class="ttdef"><b>Definition:</b> core2forAWS.h:137</div></div>
<div class="ttc" id="ai2c__device_8c_html_afc3d101f633a076cc1ca84b85b6224b2"><div class="ttname"><a href="i2c__device_8c.html#afc3d101f633a076cc1ca84b85b6224b2">TAG</a></div><div class="ttdeci">#define TAG</div><div class="ttdef"><b>Definition:</b> i2c_device.c:10</div></div>
</div><!-- fragment --><dl class="section return"><dt>Returns</dt><dd>the voltage reading from the ADC in millivolts. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
